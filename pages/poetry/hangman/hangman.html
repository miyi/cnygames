<html>
  <script type="dagger/modules">
    {
      view: "#view",
      data: "./data.js",
      script: "./script.js",
      css: "./style.css",
      board: "#board",
      bezel: "#bezel",
      row: "#row"
    }
  </script>
  <template id="view">
    <div 
      class="container"
      +loading="{
        start: false,
        bank: loadBank(),
        target: null,
        pos: 0,
      }"
    >
      <div class="control">
        <a class="cat back" href="poetry" $exist="!start" >&#x25c0&#x25c0</a>
        <div
          class="cat start"
          $exist="!start"
          +click="start=true, target=bank[pos%12], console.log(target)"
        >
          开始
        </div>
        <div $exist="start" class="cat stop" +click="start=false">
          揭秘
        </div>
        <div $exist="start" class="cat next" +click="pos++, start=false, target=null">&#x25B6;&#x25B6;</div>
      </div>
      <div $exist="!start" class="game">
        <div class="msg">
          尚未开始游戏
        </div>
      </div>
      
      <div $exist="start&&target" class="game" +loading="{char: ' ', input: '', list: [], checking: false}">
        <div class="btn-group">
          <input class="char-input" $value#input="input" $watch="char?checking=true:null" +keydown="$event.key===' '?$event.preventDefault():null" maxlength="1"/>
          <div class="input-btn" +click="pushToChar($scope)"><span>祝你好运</span></div>
        </div>
        <board +loading="target"></board>
        <div class="letter-board">
          <div $each="list">${item}</div>
        </div>
      </div>
    </div>
  </template>
  <template id="board">
    <div class="splitflap-display">
      <row $each="poem" +loading="{row: item, rowdex: index}"></row>
    </div>
  </template>
  <template id="bezel">
    <div 
      class="bezel"
      +loading="{
        key: $scope.key?key:'风',
        matched: false,
      }"
      +loaded="preMatch(key, $node, $scope)"
      $watch="check(char, matched, $node, $scope)" 
      +animationiteration="animationStart($node, $scope)" 
      +animationend="animationEnd(char, key, $node, $scope)"
    >
      <svg>
        <line x1='50%' y1='0%' x2='50%' y2='100%' />
        <line x1='0%' y1='50%' x2='100%' y2='50%' />
        <line x1='0' y1='100%' x2='100%' y2='0' />
        <line x1='0' y1='0' x2='100%' y2='100%' />
      </svg>
    </div>
  </template>
  <template id="row">
    <div class="row">
      <bezel $each="row" +loading="{key: item, keydex: index}"></bezel>
    </div>
  </template>
</html>
